{# Common macros for SVG-based embeds. #}

{%- macro status_indicator(cx, cy, user, ingame_only) -%}
{%- if user.status == "active" -%}{% set status_color = "#2ED319" %}
     {%- elif user.status == "join me" -%}{% set status_color = "#00B8FF" %}
     {%- elif user.status == "ask me" -%}{% set status_color = "#E97C03" %}
     {%- elif user.status == "busy" -%}{% set status_color = "#C80928" %}
     {%- else -%}{% set status_color = "#737F8D" %}
     {%- endif -%}
     <circle id="status-indicator {% if user.state == 'offline' %}offline{% else %}{{ user.status.replace(' ', '-') }}{% endif %}{% if user.state == 'online' %} in-game{% endif %}" cx="{{cx}}" cy="{{cy}}" {% if user.state == "online" %}r="7.5" fill="{{ status_color }}" {% elif user.state == "active" and not ingame_only %}r="6" stroke="{{ status_color }}" stroke-width="3" fill="#252A30" {% else %} r="7.5" fill="#737F8D" {% endif %}/>
{%- endmacro -%}

{%- macro status_description(user, ingame_only) -%}
{% if user.status_description %}{{ user.status_description }}{% else %}{% if user.state == "offline" %}Offline{% else %}{% if user.status == "active" and not ingame_only %}Online{% elif user.status == "join me" %}Join Me{% elif user.status == "ask me" %}Ask Me{% elif user.status == "busy" %}Do Not Disturb{% else %}Offline{% endif %}{% endif %}{% endif %}
{%- endmacro -%}

{# vrc_image_size: Get image from /api/v1/image at the specified size. #}
{%- macro vrc_image_size(url, size) -%}
{%- if url.startswith("https://api.vrchat.cloud/api/1/file") -%}{% set _url = url.replace("/api/1/file", "/api/1/image") -%}
{%- else -%}{% set _url = url %}
{%- endif -%}
{%- if url.endswith("/") -%}{% set _url = url[:-1] %}{%- endif -%}
{%- if _url.startswith("https://api.vrchat.cloud/api/1/image") -%}
  {# Explanation of the below check: we check how many levels down we are in the URL. If we have 8 slashes (https://api.vrchat.cloud/api/v1/image/.../1/512), we have the size already provided, and need to replace it; if we have 7 slashes, the size is not provided and we need to set it manually. #}
  {%- if _url.count("/") == 8 -%}{{_url[:-4]}}/{{size}}
  {%- elif _url.count("/") == 7 -%}{{_url}}/{{size}}
  {%- else -%}{{url}}
  {%- endif -%}
{%- else -%}{{url}}
{%- endif -%}
{%- endmacro -%}

{%- macro banner_url(opts, user) -%}
{{ opts.banner_url or (image_common.vrc_image_size(user.profile_pic_override_thumbnail, 512) if user.profile_pic_override_thumbnail) or (image_common.vrc_image_size(user.current_avatar_thumbnail_image_url, 512) if user.current_avatar_thumbnail_image_url)}}
{%- endmacro -%}

{%- macro vrc_logo_small(x, y, width, height) -%}
<svg viewBox="0 0 369.3096 373.33002" version="1.1" x="{{x}}" y="{{y}}" width="{{width or 369.3096}}" height="{{height or 373.33002}}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>.vs1 { fill: #fff; }</style>
  </defs>
  <path class="vs1" d="m 241.01,87.91 h -22.65 v 43.84001 h 22.65 c 13.38,0 22.03,-5.55 22.03,-21.82 C 263.04,93.660004 254.4,87.9 241.01,87.9 Z"/>
  <path class="vs1" d="M 324.63368,17.79 H 45.23 c -15.78,0 -28.56,12.78 -28.56,28.56 v 187.81001 c 0,15.78 12.76,28.56 28.56,28.56 h 179.21368 l 66.52,85.61 c 4.34,5.58 8.27,8.37 11.1,8.37 2.83,0 10.58,-2.76 10.59,-8.29 l -0.12,-84.57 v -1.11 h 12.1 c 15.76,0 28.56,-12.78 28.56,-28.56 V 46.36 c 0,-15.76 -12.78,-28.56 -28.56,-28.56 z M 174.93,77.62 135.41,207.10001 c -1.85,6.17 -9.47,9.06 -17.29,9.06 -7.82,0 -15.23,-2.89 -17.29,-9.06 L 61.1,77.62 c -0.21,-0.83 -0.41,-1.64 -0.41,-2.06 0,-6.59 9.68,-11.12 16.87,-11.12 4.53,0 8.02,1.44 9.06,5.36 L 118.12,181.36001 149.41,69.8 c 1.04,-3.91 4.53,-5.36 9.06,-5.36 7.21,0 16.87,4.74 16.87,11.12 0,0.62 -0.21,1.23 -0.41,2.06 z m 99.21,138.35001 c -3.7,0 -7.21,-2.26 -9.27,-6.38 l -29.24,-56.81 h -17.29 v 53.73 c 0,5.55 -6.59,8.44 -13.38,8.44 -6.79,0 -13.38,-2.89 -13.38,-8.44 V 72.68 h 0.02 c 0,-4.32 3.49,-8.23 8.64,-8.23 h 40.75 c 26.97,0 48.79,10.29 48.79,43.03001 0,23.67 -11.53,36.43 -26.97,41.16 l 26.97,50.02 c 0.83,1.04 1.02,2.47 1.02,3.3 0,6.79 -8.85,14 -16.67,14 z"/>
  <path d="M 322.56436,0.01 H 45.23 C 20.3,0.01 0,20.3 0,45.24 v 188.90001 c 0,24.95 20.3,45.23 45.23,45.23 h 176.48959 l 61.54,79.17 c 7.64,9.82 15.79,14.79 24.25,14.79 5.46,0 10.55,-2.11 14.38,-5.94 4.56,-4.59 6.87,-11 6.86,-19.11 l -0.08,-69.16 c 22.78,-2.31 40.64,-21.6 40.64,-45 V 45.23 c 0,-24.96 -20.29,-45.23 -45.22,-45.23 z m 30.07523,234.14001 c 0,15.78 -12.8,28.56 -28.56,28.56 h -12.1 v 1.11 l 0.12,84.57 c -0.02,5.53 -1.76,8.29 -4.59,8.29 -2.83,0 -6.76,-2.8 -11.1,-8.37 l -66.52,-85.61 H 45.23 c -15.79,0 -28.56,-12.78 -28.56,-28.56 V 46.33 c 0,-15.78 12.78,-28.56 28.56,-28.56 h 278.84959 c 15.78,0 28.56,12.8 28.56,28.56 v 187.81001 z"/>
  <path d="m 158.47,64.45 c -4.53,0 -8.02,1.45 -9.06,5.36 L 118.12,181.37001 86.62,69.81 c -1.04,-3.92 -4.53,-5.36 -9.06,-5.36 -7.19,0 -16.87,4.53 -16.87,11.12 0,0.41 0.21,1.23 0.41,2.06 l 39.73,129.48001 c 2.06,6.17 9.47,9.06 17.29,9.06 7.82,0 15.44,-2.89 17.29,-9.06 L 174.93,77.63 c 0.21,-0.83 0.41,-1.43 0.41,-2.06 0,-6.38 -9.66,-11.12 -16.87,-11.12 z" />
  <path d="m 262.81,148.64001 c 15.44,-4.74 26.97,-17.5 26.97,-41.16 C 289.78,74.73 267.96,64.45 240.99,64.45 h -40.75 c -5.15,0 -8.64,3.91 -8.64,8.23 h -0.02 v 133.83001 c 0,5.55 6.59,8.44 13.38,8.44 6.79,0 13.38,-2.89 13.38,-8.44 v -53.73 h 17.29 l 29.24,56.81 c 2.06,4.11 5.57,6.38 9.27,6.38 7.81,0 16.67,-7.21 16.67,-14 0,-0.83 -0.19,-2.26 -1.02,-3.3 l -26.97,-50.02 z m -21.8,-16.89 H 218.36 V 87.91 h 22.65 c 13.38,0 22.03,5.760004 22.03,22.03001 0,16.27 -8.64,21.82 -22.03,21.82 z" />
</svg>
{%- endmacro -%}

{%- macro vrc_logo_big(x, y, width, height) -%}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 514.36 224.33" x="{{x}}" y="{{y}}" width="{{width}}" height="{{height}}"><defs><style>.vb1,.vb2{fill:#000;stroke-width:0}.vb2{fill:#fff}</style></defs><path class="vb2" d="M318.91 38.72c-4.08 0-8.04 1.49-8.04 4.95v32.29h-27.83V43.67c0-3.46-3.96-4.95-8.04-4.95s-8.04 1.49-8.04 4.95v80.41c0 3.33 4.08 5.07 8.04 5.07s8.04-1.73 8.04-5.07v-35.5h27.83v35.5c0 3.33 4.08 5.07 8.04 5.07s8.04-1.73 8.04-5.07V43.66c0-3.46-3.96-4.95-8.04-4.95ZM144.82 52.81h-13.61v26.35h13.61c8.04 0 13.24-3.33 13.24-13.11s-5.19-13.24-13.24-13.24Zm236.67-9.39c-1.11-3.71-5.82-5.44-10.39-5.44s-9.15 1.73-10.26 5.44l-23.87 77.8c-.12.5-.25.99-.25 1.24 0 3.96 5.81 6.68 10.14 6.68 2.72 0 4.82-.87 5.44-3.22l4.7-16.46h28.33l4.71 16.46c.62 2.36 2.72 3.22 5.44 3.22 4.32 0 10.14-2.85 10.14-6.68 0-.37-.12-.74-.25-1.24l-23.87-77.8Zm-21.14 53.43 10.76-37.97 10.76 37.97h-21.53ZM225.9 52.8c11.75 0 12.61 8.41 12.86 12.25.12 3.71 3.46 5.07 8.04 5.07 5.44 0 8.04-1.49 8.04-7.92 0-14.35-12.25-23.5-29.44-23.5-15.58 0-28.57 7.68-28.57 28.33v34.51c0 20.66 12.86 28.33 28.44 28.33 17.32 0 29.57-9.52 29.57-24.49 0-6.31-2.6-7.92-8.17-7.92-4.21 0-7.67 1.24-7.92 5.07-.36 5.19-1.36 13.24-12.61 13.24v-.02c-8.54 0-13.24-4.57-13.24-14.22V67.02c0-9.64 4.7-14.22 12.99-14.22Z"/><path class="vb2" d="M487.19 10.68H27.18c-9.48 0-17.16 7.68-17.16 17.16v112.85c0 9.48 7.67 17.16 17.16 17.16h403.41l39.97 51.44c2.61 3.35 4.97 5.03 6.67 5.03s2.75-1.66 2.76-4.98l-.07-50.82v-.67h7.27c9.47 0 17.16-7.68 17.16-17.16V27.84c0-9.47-7.68-17.16-17.16-17.16ZM105.11 46.63l-23.75 77.8c-1.11 3.71-5.69 5.44-10.39 5.44s-9.15-1.73-10.39-5.44l-23.87-77.8c-.12-.5-.25-.99-.25-1.24 0-3.96 5.82-6.68 10.14-6.68 2.72 0 4.82.86 5.44 3.22l18.93 67.04 18.8-67.04c.62-2.35 2.72-3.22 5.44-3.22 4.33 0 10.14 2.85 10.14 6.68 0 .37-.12.74-.25 1.24Zm59.61 83.13c-2.22 0-4.33-1.36-5.57-3.83l-17.57-34.14h-10.39v32.29c0 3.33-3.96 5.07-8.04 5.07s-8.04-1.73-8.04-5.07V43.66h.01c0-2.6 2.1-4.95 5.19-4.95h24.49c16.21 0 29.32 6.18 29.32 25.86 0 14.22-6.93 21.89-16.21 24.74l16.21 30.05c.5.62.61 1.49.61 1.98 0 4.08-5.32 8.41-10.01 8.41Zm313.18-9.59c0 9.47-7.68 17.16-17.16 17.16H200.73c-9.47 0-17.16-7.68-17.16-17.16V47.68c0-9.47 7.68-17.16 17.16-17.16h260.01c9.47 0 17.16 7.68 17.16 17.16v72.49Z"/><path class="vb2" d="M459.54 38.72h-52.32c-3.46 0-5.07 3.72-5.07 7.18 0 3.95 1.86 7.29 5.07 7.29h18.18v70.87c0 3.33 4.08 5.07 8.04 5.07s8.04-1.73 8.04-5.07V53.19h18.06c3.21 0 5.07-3.46 5.07-7.29 0-3.47-1.61-7.18-5.07-7.18Z"/><path class="vb1" d="M487.19 0H27.18C12.2 0 0 12.19 0 27.18v113.51c0 14.99 12.2 27.18 27.18 27.18h398.5l36.98 47.57c4.59 5.9 9.49 8.89 14.57 8.89 3.28 0 6.34-1.27 8.64-3.57 2.74-2.76 4.13-6.61 4.12-11.48l-.05-41.56c13.69-1.39 24.42-12.98 24.42-27.04V27.18c0-15-12.19-27.18-27.17-27.18Zm17.16 140.69c0 9.48-7.69 17.16-17.16 17.16h-7.27v.67l.07 50.82c-.01 3.32-1.06 4.98-2.76 4.98s-4.06-1.68-6.67-5.03l-39.97-51.44H27.18c-9.49 0-17.16-7.68-17.16-17.16V27.84c0-9.48 7.68-17.16 17.16-17.16h460.01c9.48 0 17.16 7.69 17.16 17.16v112.85Z"/><path class="vb1" d="M95.22 38.72c-2.72 0-4.82.87-5.44 3.22l-18.8 67.04-18.93-67.04c-.62-2.36-2.72-3.22-5.44-3.22-4.32 0-10.14 2.72-10.14 6.68 0 .25.12.74.25 1.24l23.87 77.8c1.24 3.71 5.69 5.44 10.39 5.44s9.28-1.73 10.39-5.44l23.75-77.8c.12-.5.25-.86.25-1.24 0-3.83-5.81-6.68-10.14-6.68Zm62.7 50.59c9.28-2.85 16.21-10.51 16.21-24.74 0-19.68-13.11-25.86-29.32-25.86h-24.49c-3.1 0-5.19 2.35-5.19 4.95h-.01v80.42c0 3.33 3.96 5.07 8.04 5.07s8.04-1.73 8.04-5.07V91.79h10.39l17.57 34.14c1.24 2.47 3.35 3.83 5.57 3.83 4.7 0 10.01-4.33 10.01-8.41 0-.5-.11-1.36-.61-1.98l-16.21-30.05Zm-13.1-10.15h-13.61V52.81h13.61c8.04 0 13.24 3.46 13.24 13.24s-5.19 13.11-13.24 13.11Zm215.53 17.69h21.53l-10.77-37.97-10.76 37.97z"/><path class="vb1" d="M460.74 30.52H200.73c-9.48 0-17.16 7.69-17.16 17.16v72.49c0 9.48 7.69 17.16 17.16 17.16h260.01c9.48 0 17.16-7.69 17.16-17.16V47.68c0-9.48-7.69-17.16-17.16-17.16Zm-234.59 85.24v.02c11.25 0 12.25-8.04 12.61-13.24.25-3.83 3.71-5.07 7.92-5.07 5.57 0 8.17 1.61 8.17 7.92 0 14.97-12.25 24.49-29.57 24.49-15.58 0-28.44-7.67-28.44-28.33V67.04c0-20.65 12.99-28.33 28.57-28.33 17.19 0 29.44 9.15 29.44 23.5 0 6.43-2.6 7.92-8.04 7.92-4.58 0-7.92-1.36-8.04-5.07-.25-3.83-1.11-12.25-12.86-12.25-8.29 0-12.99 4.58-12.99 14.22v34.51c0 9.65 4.7 14.22 13.24 14.22Zm100.8 8.3c0 3.35-4.08 5.08-8.04 5.08s-8.04-1.73-8.04-5.07v-35.5h-27.83v35.5c0 3.33-4.08 5.07-8.04 5.07s-8.04-1.73-8.04-5.07V43.66c0-3.46 3.96-4.95 8.04-4.95s8.04 1.49 8.04 4.95v32.29h27.83V43.66c0-3.46 3.96-4.95 8.04-4.95s8.04 1.49 8.04 4.95v80.4Zm68.52 5.08c-2.72 0-4.82-.86-5.44-3.22l-4.71-16.46h-28.33l-4.7 16.46c-.62 2.35-2.72 3.22-5.44 3.22-4.33 0-10.14-2.72-10.14-6.68 0-.25.12-.74.25-1.24l23.87-77.8c1.11-3.71 5.69-5.44 10.26-5.44s9.28 1.73 10.39 5.44l23.87 77.8c.12.5.25.86.25 1.24 0 3.83-5.82 6.68-10.14 6.68Zm64.07-75.95h-18.06v70.87c0 3.33-4.08 5.07-8.04 5.07s-8.04-1.73-8.04-5.07V53.19h-18.18c-3.21 0-5.07-3.35-5.07-7.29 0-3.46 1.61-7.18 5.07-7.18h52.32c3.46 0 5.07 3.71 5.07 7.18 0 3.83-1.86 7.29-5.07 7.29Z"/></svg>
{%- endmacro -%}
